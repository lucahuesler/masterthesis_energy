{
  "hash": "f30e59c5fa734ff23941ae853ac2ec31",
  "result": {
    "markdown": "# Results {#results}\n\n\n\n\n\n\n\n## Preprocessing {#preprocessing}\n\n\n\n\n\n\n\n### Data matching\n\n\n\n\n\n\n\n### Conversion\n\n\n\n\n\n\n\n### Definition of data types\n\n\n\n\n\n\n### Renaming\nFor easier use in the further analysis, we convert the column names to english and use namings that are easy to understand.\n\n\n\n\n\n\n\n### Calculation HEC and HEPI\n\nTo calculate the HEC for each building, we use the @eq-hec introduced in Chapter @sec-problem-definition. Based on the HEC, we can also calculate HEPI.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nenergy_clean_06 <- energy_clean_05 %>%\n  mutate(hec = (energy_consumed_measured_mwh*efficiency_of_installation) + (energy_production_solar_mwh) - (energy_consumed_hot_water_mwh),\n         hepi = hec*1000/gross_floor_area)\n```\n:::\n\n\n\n### Data matching & filtering\n\nIn order to prepare the data for modelling, we apply the following filters:\n\n-   Only residential buildings (`gkat = 1020`)\n-   Only buildings with a HEPI \\> $20 \\ kWh/m²$ or HEPI $<300 \\ kWh/m²$\n-   Only buildings where the gas is used for HEC or for DWH+HEC. As this information is absent for many buildings, we also include `NA` values here.\n\n\n\n\n\n\n\nBy applying the above filters, we obtain a dataset of about 44839 observations. As the dataset contains measured gas consumption for the years 2016, 2018 and 2020, one building can be present three times. \n\n\n\n\n\n\n\n\n\n\n\n### Retrofit data\n\n\n\n\n\n\n\n\n\n### Cleaning\n\n\n## Exploratory Analysis {#exploratory-analysis}\n\nTo gain a first overview of the data that we use for modelling, we here present the summary statistics and plots.\n\n### Summary statistics\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskim(energy_clean_07)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |                |\n|:------------------------|:---------------|\n|Name                     |energy_clean_07 |\n|Number of rows           |44839           |\n|Number of columns        |65              |\n|_______________________  |                |\n|Column type frequency:   |                |\n|character                |5               |\n|Date                     |2               |\n|factor                   |25              |\n|logical                  |2               |\n|numeric                  |31              |\n|________________________ |                |\n|Group variables          |None            |\n\n\n**Variable type: character**\n\n|skim_variable              | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:--------------------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|house_number               |      4199|          0.91|   1|  10|     0|     6251|          0|\n|building_name              |         1|          1.00|   3|  62|     0|      686|          0|\n|entrance_number            |         0|          1.00|   1|   4|     0|      629|          0|\n|entrance_streetname        |         0|          1.00|   5|  29|     0|     1246|          0|\n|entrance_municipality_name |         0|          1.00|   6|  12|     0|       20|          0|\n\n\n**Variable type: Date**\n\n|skim_variable      | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:------------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|energy_heat_1_date |        10|             1|2000-12-31 |2022-10-26 |2020-05-19 |       11|\n|gwaerdatw1         |        10|             1|2000-12-31 |2022-10-26 |2020-05-19 |       11|\n\n\n**Variable type: factor**\n\n|skim_variable                   | n_missing| complete_rate|ordered | n_unique|top_counts                                 |\n|:-------------------------------|---------:|-------------:|:-------|--------:|:------------------------------------------|\n|survey_year                     |         0|          1.00|FALSE   |        3|201: 16317, 201: 15169, 202: 13353         |\n|energy_source_heat_1            |         0|          1.00|FALSE   |        4|752: 44742, 758: 60, 754: 35, 751: 2       |\n|energy_source_water_1           |     16317|          0.64|FALSE   |        6|752: 24982, 757: 2793, 756: 404, 753: 308  |\n|energy_usage_of_installation    |         0|          1.00|FALSE   |        2|Rau: 42746, Rau: 2093, Pro: 0, War: 0      |\n|k_gska                          |     40811|          0.09|FALSE   |        2|2: 3274, 1: 754                            |\n|solar_system_usage              |     40789|          0.09|FALSE   |        3|1: 3140, 3: 790, 2: 120                    |\n|solar_system_source             |     42735|          0.05|FALSE   |        4|3: 1038, mel: 1038, FA: 25, 2: 3           |\n|photovoltaic_system_source      |     43419|          0.03|FALSE   |        3|EBM: 595, Pri: 415, EBL: 410, AUE: 0       |\n|district_heating_id             |     44779|          0.00|FALSE   |       14|101: 14, 100: 12, 100: 6, 100: 5           |\n|district_heating_role           |     28620|          0.36|FALSE   |        3|0: 16159, 2: 54, 3: 6, 1: 0                |\n|municipality_code               |         0|          1.00|FALSE   |       20|276: 5200, 277: 5098, 277: 5073, 276: 3669 |\n|building_category               |         0|          1.00|FALSE   |        1|102: 44839, 101: 0, 103: 0, 104: 0         |\n|building_class                  |         0|          1.00|FALSE   |        3|111: 35314, 112: 6846, 112: 2679, 113: 0   |\n|building_status                 |         0|          1.00|FALSE   |        2|100: 44678, 100: 161, 100: 0, 100: 0       |\n|construction_type               |         0|          1.00|FALSE   |       13|801: 7028, 801: 6874, 801: 5482, 801: 4045 |\n|construction_month              |     43842|          0.02|FALSE   |       12|12: 478, 9: 79, 6: 78, 11: 59              |\n|building_volume_norm            |     44793|          0.00|FALSE   |        1|962: 46                                    |\n|building_volume_source          |     44793|          0.00|FALSE   |        1|857: 46                                    |\n|coordinate_system_source        |         0|          1.00|FALSE   |        1|901: 44839                                 |\n|energy_installation_1_gwr       |        10|          1.00|FALSE   |        5|743: 44271, 743: 357, 749: 75, 746: 71     |\n|energy_source_heat_1_gwr        |        10|          1.00|FALSE   |       11|752: 44474, 753: 89, 758: 71, 759: 69      |\n|energy_heat_1_source            |        10|          1.00|FALSE   |        5|870: 43814, 869: 810, 855: 141, 864: 60    |\n|energy_water_installation_1_gwr |        10|          1.00|FALSE   |        7|763: 43498, 765: 914, 761: 217, 769: 84    |\n|genw1_gwr                       |        10|          1.00|FALSE   |       13|752: 42253, 753: 1233, 756: 914, 751: 143  |\n|gwaerscew1                      |        10|          1.00|FALSE   |        6|870: 43814, 869: 807, 855: 141, 864: 60    |\n\n\n**Variable type: logical**\n\n|skim_variable       | n_missing| complete_rate| mean|count      |\n|:-------------------|---------:|-------------:|----:|:----------|\n|solar_system        |     28495|          0.36|    1|TRU: 16344 |\n|photovoltaic_system |     30421|          0.32|    1|TRU: 14418 |\n\n\n**Variable type: numeric**\n\n|skim_variable                 | n_missing| complete_rate|        mean|          sd|         p0|        p25|        p50|        p75|         p100|hist  |\n|:-----------------------------|---------:|-------------:|-----------:|-----------:|----------:|----------:|----------:|----------:|------------:|:-----|\n|egid                          |         0|          1.00| 31229439.04| 80796598.84|  390001.00|  400611.50|  409986.00|  423652.00| 245064019.00|▇▁▁▁▁ |\n|energy_consumed_measured_mwh  |         0|          1.00|       31.00|       40.36|       0.00|      15.02|      20.79|      30.93|      1430.84|▇▁▁▁▁ |\n|energy_consumed_estimated_mwh |         0|          1.00|       29.41|       33.63|       0.50|      14.66|      20.00|      29.63|      1087.27|▇▁▁▁▁ |\n|num_residents                 |      1029|          0.98|        4.16|        5.17|       1.00|       2.00|       3.00|       4.00|       167.00|▇▁▁▁▁ |\n|heating_coefficient_measured  |        85|          1.00|       85.56|       42.62|     -20.29|      55.91|      78.12|     107.04|       300.04|▂▇▂▁▁ |\n|heating_coefficient_estimated |         0|          1.00|       80.01|       13.45|      42.99|      71.61|      86.03|      89.63|        98.04|▁▅▃▇▇ |\n|gross_floor_area              |         0|          1.00|      309.10|      340.44|      35.00|     152.00|     208.00|     306.00|     10315.00|▇▁▁▁▁ |\n|year_of_installation          |         0|          1.00|     2001.42|       67.33|       0.00|    1999.00|    2005.00|    2010.00|      2020.00|▁▁▁▁▇ |\n|efficiency_of_installation    |         0|          1.00|        0.92|        0.04|       0.85|       0.85|       0.95|       0.95|         0.95|▃▁▁▁▇ |\n|energy_consumed_hot_water_kwh |         0|          1.00|     2424.98|     4018.25|       0.00|       0.00|    1700.00|    3400.00|    141950.00|▇▁▁▁▁ |\n|energy_production_solar_kwh   |     40123|          0.11|     3678.44|     3271.88|     520.00|    2340.00|    2600.00|    3640.00|     48880.00|▇▁▁▁▁ |\n|solar_system_area_m2          |     40160|          0.10|        7.78|        6.63|       1.00|       5.00|       5.00|       8.00|        94.00|▇▁▁▁▁ |\n|photovoltaic_system_power_kw  |     43423|          0.03|        6.99|        4.13|       1.00|       4.47|       6.00|       8.40|        33.90|▇▃▁▁▁ |\n|heated_by_egid                |     44462|          0.01| 35094318.09| 85039770.85|  390032.00|  394359.00|  405816.00|  423145.00| 245060732.00|▇▁▁▁▁ |\n|construction_year             |         0|          1.00|     1962.72|       42.71|    1582.00|    1947.00|    1973.00|    1988.00|      2016.00|▁▁▁▂▇ |\n|demolition_year               |     44678|          0.00|     2019.83|        1.47|    2017.00|    2019.00|    2020.00|    2021.00|      2022.00|▅▂▇▅▃ |\n|building_area_m2              |         0|          1.00|      110.21|       81.66|      23.34|      64.94|      84.84|     122.99|      3683.88|▇▁▁▁▁ |\n|building_volume_m3            |     44784|          0.00|     1140.64|      564.41|     435.00|     764.00|    1009.00|    1286.50|      2470.00|▅▇▂▁▂ |\n|energy_reference_area         |     44836|          0.00|       27.00|        0.00|      27.00|      27.00|      27.00|      27.00|        27.00|▁▁▇▁▁ |\n|coordinate_e                  |         0|          1.00|  2613134.07|     4715.94| 2604529.41| 2609281.42| 2612107.96| 2615184.39|   2625155.28|▃▇▅▂▂ |\n|coordinate_n                  |         0|          1.00|  1262773.42|     2643.82| 1256207.85| 1260973.58| 1262910.48| 1264612.01|   1267875.27|▂▅▇▇▅ |\n|num_floors                    |         0|          1.00|        2.62|        0.87|       1.00|       2.00|       3.00|       3.00|        16.00|▇▁▁▁▁ |\n|num_separate_living_space     |     39091|          0.13|        0.44|        1.25|       0.00|       0.00|       0.00|       0.00|        25.00|▇▁▁▁▁ |\n|num_dwellings                 |         0|          1.00|        1.90|        2.68|       0.00|       1.00|       1.00|       1.00|        76.00|▇▁▁▁▁ |\n|meters_above_sealevel         |         0|          1.00|      310.71|       30.31|     251.60|     288.50|     304.10|     329.00|       446.10|▅▇▃▁▁ |\n|entrance_postal_code          |         0|          1.00|     4165.63|       97.59|    4102.00|    4107.00|    4132.00|    4153.00|      4415.00|▇▁▁▁▁ |\n|entrance_postal_code_add      |         0|          1.00|        0.00|        0.00|       0.00|       0.00|       0.00|       0.00|         0.00|▁▁▇▁▁ |\n|energy_production_solar_mwh   |         0|          1.00|        0.39|        1.55|       0.00|       0.00|       0.00|       0.00|        48.88|▇▁▁▁▁ |\n|energy_consumed_hot_water_mwh |         0|          1.00|        2.42|        4.02|       0.00|       0.00|       1.70|       3.40|       141.95|▇▁▁▁▁ |\n|hec                           |         0|          1.00|       26.51|       34.61|       1.37|      12.59|      17.89|      26.93|      1201.99|▇▁▁▁▁ |\n|hepi                          |         0|          1.00|       92.12|       43.74|      20.01|      61.27|      83.56|     113.55|       299.95|▇▇▂▁▁ |\n:::\n:::\n\n\n\n### Density and boxplots\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot_construction_year\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-15-1.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nboxplot_building_area_m2\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-15-2.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nboxplot_num_residents\n#> Warning: Removed 1029 rows containing non-finite values (`stat_boxplot()`).\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-15-3.pdf){fig-pos='H'}\n:::\n\n```{.r .cell-code}\nboxplot_year_of_installation\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-15-4.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/histogram-1.pdf)\n:::\n:::\n\n\n\nAs the histogram is right-skewed (a few houses with a high energy use), it makes sense to log-transform.\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/histogram-log-1.pdf)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrelations <- energy_clean_07 %>%\n  select(where(is.numeric)) %>%\n  correlations()\n#> Warning in stats::cor(x, use = use, method = method): the standard deviation is\n#> zero\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nenergy_clean_log <- energy_clean_07 %>%\n  mutate(energy_consumed_measured_mwh_log = log(energy_consumed_measured_mwh),\n         hepi_log = log(hepi))\n```\n:::\n\n\n\n\n## Modelling\n\nTrain/test split\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\n#> Set the random number stream using `set.seed()` so that the results can be \n#> reproduced later. \nset.seed(501)\n\n#> Save the split information for an 80/20 split of the data\nenergy_split <- initial_split(energy_clean_log, prop = 0.80, strata = energy_consumed_measured_mwh)\nenergy_split\n#> <Training/Testing/Total>\n#> <35870/8969/44839>\n\n\n#> Creating train and test set\nenergy_train <- training(energy_split)\nenergy_test  <-  testing(energy_split)\n\ndim(energy_train)\n#> [1] 35870    67\n\n#> Resampling train set\nset.seed(123)\nfolds <- vfold_cv(energy_train, v = 5, strata = energy_consumed_measured_mwh)\nfolds\n#> #  5-fold cross-validation using stratification \n#> # A tibble: 5 x 2\n#>   splits               id   \n#>   <list>               <chr>\n#> 1 <split [28694/7176]> Fold1\n#> 2 <split [28695/7175]> Fold2\n#> 3 <split [28697/7173]> Fold3\n#> 4 <split [28697/7173]> Fold4\n#> 5 <split [28697/7173]> Fold5\n```\n:::\n\n\n\n### Multiple linear regression\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n\nlm_model <- \n  linear_reg() %>% \n  set_engine(\"lm\")\n\nlm_form_fit <- \n  lm_model %>% \n  fit(hec ~ gross_floor_area + survey_year, data = energy_clean_log)\n\nlm_form_fit\n#> parsnip model object\n#> \n#> \n#> Call:\n#> stats::lm(formula = hec ~ gross_floor_area + survey_year, data = data)\n#> \n#> Coefficients:\n#>      (Intercept)  gross_floor_area   survey_year2018   survey_year2020  \n#>          2.60347           0.07775          -0.98750           0.70294\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy(lm_form_fit)\n#> # A tibble: 4 x 5\n#>   term             estimate std.error statistic  p.value\n#>   <chr>               <dbl>     <dbl>     <dbl>    <dbl>\n#> 1 (Intercept)        2.60    0.199        13.1  4.66e-39\n#> 2 gross_floor_area   0.0777  0.000309    251.   0       \n#> 3 survey_year2018   -0.988   0.251        -3.93 8.59e- 5\n#> 4 survey_year2020    0.703   0.260         2.70 6.89e- 3\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprediction <- predict(lm_form_fit, energy_test)\n\ntest_res <- bind_cols(prediction, energy_test %>% select(egid, building_name, hec))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(test_res, aes(x = hec, y = .pred)) + \n  #> Create a diagonal line:\n  geom_abline(lty = 2) + \n  geom_point(alpha = 0.5) + \n  labs(y = \"Predicted Energy use (log10)\", x = \"Measured energy use (log10)\") +\n  #> Scale and size the x- and y-axis uniformly:\n  coord_obs_pred()\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-22-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(energy_clean_log, aes(x = log(hec), y = log(energy_consumed_estimated_mwh))) + \n  #> Create a diagonal line:\n  geom_abline(lty = 2) + \n  geom_point(alpha = 0.5) + \n  labs(y = \"Predicted Energy use (log10)\", x = \"Measured energy use (log10)\") +\n  #> Scale and size the x- and y-axis uniformly:\n  coord_obs_pred()\n```\n\n::: {.cell-output-display}\n![](04-Results_files/figure-pdf/unnamed-chunk-23-1.pdf){fig-pos='H'}\n:::\n:::\n",
    "supporting": [
      "04-Results_files/figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}