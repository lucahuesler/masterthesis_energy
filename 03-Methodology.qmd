# Methodology {#sec-methodology}

In order to address the research questions defined in @sec-research-questions--goals, we first need to define a suitable methodology. From a high-level perspective, a machine learning workflow follows the following steps:

1.  Problem understanding and definition
2.  Data preparation and cleaning
3.  Exploratory data analysis (EDA)
4.  Data preprocessing and feature engineering
5.  Modelling
    1.  Model development and training

    2.  Model evaluation
6.  Model selection and deployment

However, the above steps are usually not carried out in a linear manner. Usually, a first comparison evaluation of models leads to a better understanding of the data and can provide new ideas for more feature engineering steps. @fig-modelling-process provides a overview of a typical modelling process.

![A schematic for the typical modeling process [@silge].](figures/03-fig-modelling-process.png){#fig-modelling-process}

## Data unterstanding and exploration {#sec-data-unterstanding-and-exploration}

## Data preparation {#sec-data-prep}

In order to prepare the data for modelling, we apply the following filters:

-   Only residential buildings (`gkat = 1020`)
-   Only buildings with a HEPI \> 20 kWh/m² or HEPI \<300 kWh/m²
-   Only buildings where the gas is used for HEC or for DWH+HEC. As this information is absent for many buildings, we also include `NA` values here.

## Modelling {#sec-modelling}

The modelling strategy of the present study is guided by the research questions as defined in @sec-research-questions . In a first step, all the available buildings after applying the filters defined in @sec-data-prep will be used for modelling. After splitting the data into a test and training set, we will train different models on our training data. By focussing on

```{mermaid}

graph TD
    A[Initial data] -->|Preprocessing| B(Test data 20 %)
    A[Initial data] -->|Preprocessing| C(Training data 80%)
    C --> D([Variable selection<br>1. All predictors<br>2.Without retrofit<br>3.Without socio-economic])
    style D text-align:left
    D --> E[Multiple linear regression]
    D --> F[fa:fa-tree Random forest]
    D --> G[Artificial neural network]
    D --> H[...]
    E --> I(Model evaluation <br> - Compare metrics <br> - Feature importance) 
    F --> I 
    G --> I
    H --> I 
    style I text-align:left
```

## Evaluation metrics {#evaluation-metrics}

For evaluation and comparison of the different models, we will use the following metrics:

-   Root mean squared error (RMSE)
-   Mean absolute error (MAE)
-   Mean absolute percentage error (MAPE)
-   R-Squared ($$R²$$)

In the following, we will present the mathematical formula and a short explanation of the metrics that will be used for evaluation.

#### RMSE

The Root mean squared error (RMSE) is a measure of the differences between predicted and actual values. It is calculated by taking the square root of the mean of the squared differences between predicted and actual values. The formula for RMSE is given as:

$$ RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y_i})^2} $$

where $y_i$ represents the actual values, $\hat{y_i}$ represents the predicted values and $n$ represents the number of samples.

### MAE

The Mean absolute error (MAE) is another measure of the differences between predicted and actual values. Unlike RMSE, it is not squared, so it is less sensitive to outliers. It is calculated as the average of the absolute differences between predicted and actual values. The formula for MAE is given as:

$$ MAE = \frac{1}{n} \sum_{i=1}^{n} \left| y_i - \hat{y_i} \right| $$

where $y_i$ represents the actual values, $\hat{y_i}$ represents the predicted values and $n$ represents the number of samples.

### MAPE

The Mean absolute percentage error (MAPE) is a measure of the differences between predicted and actual values as a percentage. It is calculated as the average of the absolute differences between predicted and actual values, expressed as a percentage of the actual values. The formula for MAPE is given as:

$$ MAPE = \frac{100}{n} \sum_{i=1}^{n} \left| \frac{y_i - \hat{y_i}}{y_i} \right| $$

where $y_i$ represents the actual values, $\hat{y_i}$ represents the predicted values and $n$ represents the number of samples.

### R-Squared

R-Squared ($$R²$$) is a measure of the goodness of fit of a linear regression model. It is calculated as the ratio of explained variance to total variance. A higher R-Squared value indicates that a larger proportion of the variance in the dependent variable is explained by the independent variables. The formula for R-Squared is given as:

$$ R^2 = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y_i})^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2} $$

where $y_i$ represents the actual values, $\hat{y_i}$ represents the predicted values, $\bar{y}$ represents the mean of the actual values, and $n$ represents the number of samples.
